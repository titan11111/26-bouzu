<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>åƒ§ä¾¶ã®ç›¸è«‡ã‚²ãƒ¼ãƒ </title>
<style>
body {font-family: 'Sawarabi Mincho', 'Yu Mincho', serif;background: #f5f5dc;margin:0;padding:20px;}
.status{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.status-item{background:#fff;padding:5px 10px;border:1px solid #ccc;border-radius:4px;}
.advice-buttons{display:flex;flex-direction:column;gap:5px;margin-top:10px;}
.result{margin-top:15px;padding:10px;border-radius:4px;white-space:pre-line;}
.result.success{background:#e0ffe0;}
.result.failure{background:#ffe0e0;}
</style>
</head>
<body>
<h1>åƒ§ä¾¶ã®ç›¸è«‡ã‚²ãƒ¼ãƒ </h1>
<div class="status">
  <div class="status-item">æ„Ÿè¬:<span id="score">0</span></div>
  <div class="status-item">æ®‹ã‚Š:<span id="remaining">0</span></div>
  <div class="status-item">ã‚³ãƒ³ãƒœ:<span id="combo">0</span></div>
</div>
<div class="status">
  <div class="status-item">æ…ˆæ‚²:<span id="stat-compassion">0</span></div>
  <div class="status-item">çœŸç†:<span id="stat-truth">0</span></div>
  <div class="status-item">ç„¡å¸¸è¦³:<span id="stat-impermanence">0</span></div>
  <div class="status-item">æ±‚é“å¿ƒ:<span id="stat-quest">0</span></div>
</div>

<div id="consultation-card">
  <div id="visitor-name"></div>
  <div id="consultation-text"></div>
</div>
<div id="advice-buttons" class="advice-buttons">
  <button onclick="selectAdvice(0)" id="advice1"></button>
  <button onclick="selectAdvice(1)" id="advice2"></button>
  <button onclick="selectAdvice(2)" id="advice3"></button>
</div>
<div id="result" class="result" style="display:none;">
  <div id="result-text"></div>
  <div id="result-message"></div>
  <div id="selected-advice"></div>
  <button onclick="nextConsultation()">æ¬¡ã¸</button>
</div>

<script>
const MAX_LINE_LENGTH = 25;
function formatAdviceText(text){
  let t=text.trim();
  if(t.length>MAX_LINE_LENGTH*2){t=t.slice(0,MAX_LINE_LENGTH*2-1)+'â€¦';}
  if(t.length>MAX_LINE_LENGTH){return t.slice(0,MAX_LINE_LENGTH)+"\n"+t.slice(MAX_LINE_LENGTH);}
  return t;
}

const consultations = [
 { name:"ç”°ä¸­ã•ã‚“ï¼ˆä¼šç¤¾å“¡ï¼‰", icon:"ğŸ‘¨â€ğŸ’¼", traits:["çœŸé¢ç›®","ã‚¹ãƒˆãƒ¬ã‚¹"], problem:"ä»•äº‹ã§ã®ã‚¹ãƒˆãƒ¬ã‚¹ãŒæºœã¾ã‚Šã€æ¯æ—¥ãŒè¾›ãæ„Ÿã˜ã¾ã™ã€‚", preferredType:"å…±æ„Ÿ",
   adviceOptions:[
     {text:"ãã‚Œã¯å¤§å¤‰ã§ã™ã­ã€‚ã¾ãšä»Šå¤œãã£ã™ã‚Šçœ ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã—ã‚‡ã†",type:"å…±æ„Ÿ",effects:{compassion:2},reaction:"ã€Œå°‘ã—æ°—æŒã¡ãŒæ¥½ã«ãªã‚Šã¾ã—ãŸã€",aftermath:"æ•°æ—¥å¾Œã€å½¼ã¯ä¼‘æ¯ã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚"},
     {text:"å•é¡Œã®æ ¹æœ¬ã¯ä½•ã§ã™ã‹ï¼Ÿç´™ã«æ›¸ãå‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†",type:"è§£æ±º",effects:{truth:2},reaction:"ã€Œæ•´ç†ã—ã¦ã¿ã¾ã™ã€",aftermath:"å½¼ã¯ãƒãƒ¼ãƒˆã«æ‚©ã¿ã‚’æ›¸ãå‡ºã—ã€è§£æ±ºç­–ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚"},
     {text:"æ»ã«æ‰“ãŸã‚Œã¦é­‚ã‚’æµ„åŒ–ã—ã¾ã—ã‚‡ã†",type:"å¥‡æŠœ",effects:{quest:1},reaction:"ã€Œãˆã£ã€æ»ã§ã™ã‹ï¼Ÿã€",aftermath:"æ»è¡Œã«æŒ‘æˆ¦ã—ãŸã‚‚ã®ã®ã€é¢¨é‚ªã‚’ã²ã„ã¦ã—ã¾ã„ã¾ã—ãŸã€‚"}
   ]},
 { name:"ä½è—¤ã•ã‚“ï¼ˆä¸»å©¦ï¼‰", icon:"ğŸ‘©", traits:["å®¶æ—æ€ã„","æ„Ÿæƒ…çš„"], problem:"å®¶æ—ã¨ã®é–¢ä¿‚ãŒã†ã¾ãã„ã‹ãšã€å­¤ç‹¬ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚", preferredType:"è§£æ±º",
   adviceOptions:[
     {text:"ç›¸æ‰‹ã®æ°—æŒã¡ã‚’æƒ³åƒã—ã¦æ‰‹ç´™ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†",type:"å…±æ„Ÿ",effects:{compassion:2},reaction:"ã€Œæ‰‹ç´™ãªã‚‰ç´ ç›´ã«æ›¸ã‘ãã†ã§ã™ã€",aftermath:"å¾Œæ—¥ã€å®¶æ—ã¨é™ã‹ã«è©±ã—åˆã†æ™‚é–“ãŒæŒã¦ã¾ã—ãŸã€‚"},
     {text:"å®¶åº­ã®ãƒ«ãƒ¼ãƒ«ã‚’ç´™ã«æ›¸ã„ã¦è©±ã—åˆã„ã¾ã—ã‚‡ã†",type:"è§£æ±º",effects:{truth:2},reaction:"ã€Œãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚‹ã®ã‚‚å¤§äº‹ã§ã™ã­ã€",aftermath:"å®¶æ—ä¼šè­°ã§ãŠäº’ã„ã®æ°—æŒã¡ã‚’å…±æœ‰ã§ããŸã‚ˆã†ã§ã™ã€‚"},
     {text:"æ»ã«æ‰“ãŸã‚Œã¦é­‚ã‚’æµ„åŒ–ã—ã¾ã—ã‚‡ã†",type:"å¥‡æŠœ",effects:{quest:1},reaction:"ã€Œã„ã‚„ã€æ»ã¯ã¡ã‚‡ã£ã¨â€¦ã€",aftermath:"ç‰¹ã«å¤‰åŒ–ã¯ãªã‹ã£ãŸã‚ˆã†ã§ã™ã€‚"}
   ]},
 { name:"éˆ´æœ¨ã•ã‚“ï¼ˆå¤§å­¦ç”Ÿï¼‰", icon:"ğŸ‘¨â€ğŸ“", traits:["æ‹æ„›è‡³ä¸Šä¸»ç¾©"], problem:"å¤±æ‹ã—ã¦ç«‹ã¡ç›´ã‚Œã¾ã›ã‚“ã€‚ã‚‚ã†èª°ã‚‚æ„›ã›ãªã„ã¨æ€ã„ã¾ã™ã€‚", preferredType:"å…±æ„Ÿ",
   adviceOptions:[
     {text:"æ™‚é–“ãŒå¿ƒã®å‚·ã‚’ç™’ã—ã¦ãã‚Œã¾ã™ã€‚è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã—ã¦ã€æ–°ã—ã„å‡ºä¼šã„ã‚’ä¿¡ã˜ã¦ãã ã•ã„",type:"å…±æ„Ÿ",effects:{compassion:1,impermanence:1},reaction:"ã€Œå°‘ã—å¸Œæœ›ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€",aftermath:"ã‚†ã£ãã‚Šã¨å‰ã‚’å‘ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ˆã†ã§ã™ã€‚"},
     {text:"å…ƒå½¼ã®å®¶ã®å‰ã§æ­Œã‚’æ­Œã„ã¾ã—ã‚‡ã†",type:"å¥‡æŠœ",effects:{quest:2},reaction:"ã€Œã„ã‚„ã€ãã‚Œã¯æ¥ãšã‹ã—ã„ã§ã™â€¦ã€",aftermath:"å½¼ã¯æ­Œã‚ãªã‹ã£ãŸãŒã€ä»£ã‚ã‚Šã«ã‚«ãƒ©ã‚ªã‚±ã§ç™ºæ•£ã—ãŸãã†ã§ã™ã€‚"},
     {text:"å•é¡Œã®æ ¹æœ¬ã¯ä½•ã§ã™ã‹ï¼Ÿç´™ã«æ›¸ãå‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†",type:"è§£æ±º",effects:{truth:1},reaction:"ã€Œæ„Ÿæƒ…ã‚’æ•´ç†ã™ã‚‹ã®ã‚‚å¤§äº‹ã§ã™ã­ã€",aftermath:"ãƒãƒ¼ãƒˆã«æ°—æŒã¡ã‚’æ›¸ãã“ã¨ã§å¿ƒãŒæ•´ç†ã§ãã¾ã—ãŸã€‚"}
   ]}
];
consultations.forEach(c=>c.adviceOptions.forEach(o=>{o.text=formatAdviceText(o.text);}));

let currentConsultation=0;
let score=0;
let remainingVisitors=consultations.length;
let combo=0;
let maxCombo=0;
let totalCorrect=0;
let totalIncorrect=0;
let playerStats={compassion:0,truth:0,impermanence:0,quest:0};

function initGame(){
  currentConsultation=0;
  score=0;
  remainingVisitors=consultations.length;
  combo=0;
  maxCombo=0;
  totalCorrect=0;
  totalIncorrect=0;
  playerStats={compassion:0,truth:0,impermanence:0,quest:0};
  updateDisplay();
  showConsultation();
}

function updateDisplay(){
  document.getElementById('score').textContent=score;
  document.getElementById('remaining').textContent=remainingVisitors;
  document.getElementById('combo').textContent=combo;
  document.getElementById('stat-compassion').textContent=playerStats.compassion;
  document.getElementById('stat-truth').textContent=playerStats.truth;
  document.getElementById('stat-impermanence').textContent=playerStats.impermanence;
  document.getElementById('stat-quest').textContent=playerStats.quest;
}

function showConsultation(){
  const c=consultations[currentConsultation];
  document.getElementById('visitor-name').textContent=c.name;
  document.getElementById('consultation-text').textContent=c.problem;
  const buttons=document.querySelectorAll('.advice-buttons button');
  c.adviceOptions.forEach((o,i)=>{
    buttons[i].textContent=o.text;
    buttons[i].style.display='block';
  });
  document.getElementById('result').style.display='none';
  document.getElementById('selected-advice').textContent='';
  document.getElementById('advice-buttons').style.display='flex';
}

function effectsToText(effects){
  const names={compassion:'æ…ˆæ‚²',truth:'çœŸç†',impermanence:'ç„¡å¸¸è¦³',quest:'æ±‚é“å¿ƒ'};
  return Object.entries(effects).map(([k,v])=>names[k]+(v>=0?'+':'')+v).join(' ');
}

function applyEffects(effects){
  for(const [k,v] of Object.entries(effects)){playerStats[k]+=v;}
}

function selectAdvice(index){
  const c=consultations[currentConsultation];
  const option=c.adviceOptions[index];
  applyEffects(option.effects);
  const result=document.getElementById('result');
  const resultText=document.getElementById('result-text');
  const resultMessage=document.getElementById('result-message');
  const selected=document.getElementById('selected-advice');
  document.getElementById('advice-buttons').style.display='none';

  if(option.type===c.preferredType){
    totalCorrect++; combo++; if(combo>maxCombo)maxCombo=combo;
    score+=1; result.className='result success';
    resultText.textContent='âœ¨ è‰¯ã„å°ãã§ã™ï¼ +1ãƒã‚¤ãƒ³ãƒˆ âœ¨';
  }else{
    totalIncorrect++; combo=0;
    result.className='result failure';
    resultText.textContent='ğŸ˜” ã‚‚ã†å°‘ã—è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†... ğŸ˜”';
  }
  resultMessage.textContent=option.reaction;
  selected.textContent='ãã®å¾Œ: '+option.aftermath+' ('+effectsToText(option.effects)+')';
  result.style.display='block';
  updateDisplay();
}

function nextConsultation(){
  currentConsultation++; remainingVisitors--;
  if(currentConsultation>=consultations.length){
    showGameOver();
  }else{
    document.getElementById('advice-buttons').style.display='flex';
    showConsultation();
  }
}

function showGameOver(){
  document.getElementById('consultation-card').style.display='none';
  document.getElementById('advice-buttons').style.display='none';
  document.getElementById('result').style.display='none';
  const accuracy=(totalCorrect/(totalCorrect+totalIncorrect))*100;
  document.body.innerHTML+=`<h2>ã‚²ãƒ¼ãƒ çµ‚äº†</h2><p>æœ€çµ‚å¾—ç‚¹:${score}</p><p>æ­£è§£ç‡:${Math.round(accuracy)}%</p>`;
}

window.onload=initGame;
</script>
</body>
</html>
